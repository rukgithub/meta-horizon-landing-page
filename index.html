<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <title>Drømme‑univers • 360° galleri med rutsjebaner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- A‑Frame core -->
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <!-- Lokomotion (smooth movement, keyboard/gamepad/touch) -->
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.0/dist/aframe-extras.min.js"></script>
  <!-- Teleport/blink med rotation (thumbstick) -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls@0.4.3/dist/aframe-blink-controls.min.js"></script>

  <style>
    html,body { margin:0; height:100%; background:#000; }
    .a-enter-vr-button,.a-enter-ar-button { z-index: 999; }
  </style>

  <script>
  /*
   * Galleri‑ring komponent
   * Placerer 12 billeder i en cirkel omkring brugeren. Når der klikkes på
   * bestemte billeder udløses en rutsjebaneoplevelse; ellers vises billedet
   * i en lightbox. Indekset starter ved 0 (første billede i løkken).
   */
  AFRAME.registerComponent('gallery-ring', {
    schema: {
      radius: {type:'number', default: 14},
      count:  {type:'int',    default: 12},
      y:      {type:'number', default: 1.6},
      width:  {type:'number', default: 3.0},
      height: {type:'number', default: 2.0}
    },
    init: function(){
      const d = this.data;
      const root = this.el;
      for (let i=0; i<d.count; i++){
        const angle = (i/d.count) * Math.PI*2;
        const x = d.radius * Math.sin(angle);
        const z = d.radius * Math.cos(angle);
        const rotY = -THREE.MathUtils.radToDeg(angle) + 180;
        const n = i+1; // til id-valg i assets
        // find asset id hvis eksisterer ellers fallback til img1
        const asset = document.querySelector('#img'+n) ? '#img'+n : '#img1';
        const plane = document.createElement('a-plane');
        plane.setAttribute('width', d.width);
        plane.setAttribute('height', d.height);
        plane.setAttribute('position', `${x} ${d.y} ${z}`);
        plane.setAttribute('rotation', `0 ${rotY} 0`);
        plane.setAttribute('material', `src: ${asset}; side: double; shader: standard; metalness: 0; roughness: 0.85`);
        plane.classList.add('clickable');
        // lidt emissive glow ved hover
        plane.setAttribute('animation__hoverOn', 'property: components.material.material.emissiveIntensity; startEvents: mouseenter; to: 0.25; dur: 160');
        plane.setAttribute('animation__hoverOff','property: components.material.material.emissiveIntensity; startEvents: mouseleave;  to: 0.0;  dur: 200');
        plane.setAttribute('animation__click',   'property: scale; startEvents: click; to: 1.05 1.05 1.05; dir: alternate; dur: 140');
        // click handler
        plane.addEventListener('click', () => {
          const viewer = document.querySelector('#viewer');
          // hvis første billede -> halloween rutsjebane
          if (i === 0) {
            startHalloweenSlide();
          } else if (i === 1) {
            // andet billede -> galakse rutsjebane
            startGalaxySlide();
          } else if (i === d.count-1) {
            // sidste billede -> generel rutsjebane
            startGeneralSlide();
          } else {
            // vis billede i viewer
            viewer.setAttribute('material','src', asset);
            viewer.emit('show');
          }
        });
        root.appendChild(plane);
      }
    }
  });

  /* Statiske stjerner med langsom blink (8-12 sek). */
  AFRAME.registerComponent('star-spheres', {
    schema: {count:{default: 600}, spread:{default: 140}},
    init: function(){
      const {count, spread} = this.data;
      for (let i=0; i<count; i++){
        const s = document.createElement('a-sphere');
        const x = (Math.random()-0.5) * spread;
        const y = (Math.random()-0.3) * spread * 0.7 + 8;
        const z = (Math.random()-0.5) * spread;
        const r = Math.random()*0.12 + 0.01;
        s.setAttribute('position', `${x} ${y} ${z}`);
        s.setAttribute('radius', r);
        s.setAttribute('material','color:#fff; emissive:#fff; emissiveIntensity:0.3; shader:standard; fog:false');
        const target = (0.1 + Math.random()*0.3).toFixed(2);
        const dur = 8000 + Math.floor(Math.random()*4000);
        s.setAttribute('animation__twinkle', `property: components.material.material.emissiveIntensity; dir: alternate; loop: true; to: ${target}; dur: ${dur}; easing: easeInOutSine`);
        this.el.appendChild(s);
      }
    }
  });

  /* Rutsjebane funktioner
   * Hver funktion repositionerer kamera‑riggen og animerer den langs en straight linje. Kurver
   * synliggøres via a-curve/a-tube i scenen. Viewer skjules mens man kører.
   */
  function startGeneralSlide() {
    const rig = document.querySelector('#rig');
    // skjul viewer hvis åben
    document.querySelector('#viewer').emit('click');
    // startposition oppe på banen
    rig.setAttribute('position', '0 4 0');
    // animation til bunden af banen
    rig.setAttribute('animation__slide', 'property: position; to: 0 1.6 -25; dur: 9000; easing: easeInOutCubic');
  }

  function startGalaxySlide() {
    const rig = document.querySelector('#rig');
    document.querySelector('#viewer').emit('click');
    // startposition for galaksebanen
    rig.setAttribute('position', '0 4 0');
    // længere tur med stjerner
    rig.setAttribute('animation__slide', 'property: position; to: 0 1.6 -30; dur: 11000; easing: easeInOutCubic');
  }

  function startHalloweenSlide() {
    const rig = document.querySelector('#rig');
    document.querySelector('#viewer').emit('click');
    // start ved toppen af halloween‑banen
    rig.setAttribute('position', '0 4 0');
    // en uhyggelig længere tur med twist
    rig.setAttribute('animation__slide', 'property: position; to: 0 1.6 -35; dur: 12000; easing: easeInOutCubic');
  }

  /* Lightbox‑viewer komponent. Vis billedet når show‑event fyrer; klik for at lukke. */
  AFRAME.registerComponent('image-viewer', {
    init: function(){
      const el = this.el;
      el.setAttribute('visible','false');
      el.setAttribute('scale','0.001 0.001 0.001');
      el.addEventListener('show', () => {
        el.setAttribute('visible','true');
        el.setAttribute('animation__scaleIn','property: scale; to: 1 1 1; dur: 200; easing: easeOutQuad');
        el.setAttribute('animation__fadeIn','property: material.opacity; to: 1; dur: 200');
      });
      el.addEventListener('click', () => {
        el.setAttribute('animation__scaleOut','property: scale; to: 0.001 0.001 0.001; dur: 180; easing: easeInQuad');
        el.setAttribute('animation__fadeOut','property: material.opacity; to: 0; dur: 180');
        setTimeout(() => { el.setAttribute('visible','false'); }, 200);
      });
    }
  });

  /* Snap-turn for desktop brugere med Q/E eller piletaster */
  AFRAME.registerComponent('snap-turn-keys', {
    schema: {angle:{default: 22.5}},
    init: function(){
      const rig = this.el;
      const a = this.data.angle;
      window.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' || e.key.toLowerCase() === 'q') rotate(-a);
        if (e.key === 'ArrowRight' || e.key.toLowerCase() === 'e') rotate(a);
      });
      function rotate(dy){
        const r = rig.getAttribute('rotation');
        rig.setAttribute('rotation', `${r.x} ${r.y + dy} ${r.z}`);
      }
    }
  });
  </script>
</head>

<body>
  <a-scene
    renderer="antialias: true; colorManagement: true; physicallyCorrectLights: true"
    background="color: #000000"
    vr-mode-ui="enabled: true"
    device-orientation-permission-ui="enabled: true">

    <!-- Assets: Billeder. Første to er halloween og rutsjebane, resten fallback velkommen -->
    <a-assets timeout="15000">
      <img id="img1" src="halloween.png" />
      <img id="img2" src="rutsjebane.png" />
      <img id="img3" src="velkommen.png" />
      <img id="img4" src="velkommen.png" />
      <img id="img5" src="velkommen.png" />
      <img id="img6" src="velkommen.png" />
      <img id="img7" src="velkommen.png" />
      <img id="img8" src="velkommen.png" />
      <img id="img9" src="velkommen.png" />
      <img id="img10" src="velkommen.png" />
      <img id="img11" src="velkommen.png" />
      <img id="img12" src="velkommen.png" />
    </a-assets>

    <!-- Lys -->
    <a-entity light="type: ambient; intensity: 0.6"></a-entity>
    <a-entity light="type: directional; intensity: 0.35" position="2 4 -3"></a-entity>

    <!-- Planeter i baggrunden -->
    <a-sphere position="-8 3 -20" radius="3.5" color="#6bd1ff"
              material="metalness:0.1; roughness:0.9; emissive:#093a75; emissiveIntensity:0.25"></a-sphere>
    <a-sphere position="10 2 -28" radius="4.0" color="#f4a261"
              material="metalness:0.1; roughness:0.9; emissive:#6a3a05; emissiveIntensity:0.25"
              animation="property: rotation; to: 0 360 0; dur: 50000; loop: true; easing: linear"></a-sphere>

    <!-- Stjerner -->
    <a-entity star-spheres="count: 800; spread: 160"></a-entity>

    <!-- Store jorden/gulv til at gå på -->
    <a-plane position="0 0 -10" rotation="-90 0 0" width="200" height="200" color="#050708"
             material="shader: standard; metalness: 0.1; roughness: 0.9"></a-plane>

    <!-- Rutsjebane kurver (kun til visuelt formål). De faktiske animationer styres i JS functions ovenfor. -->
    <!-- Generel rutsjebane (blå) -->
    <a-curve id="curveGeneral">
      <a-curve-point position="0 4 0"></a-curve-point>
      <a-curve-point position="0 3 -6"></a-curve-point>
      <a-curve-point position="1.5 2 -12"></a-curve-point>
      <a-curve-point position="0 1.6 -25"></a-curve-point>
    </a-curve>
    <a-entity shadow="receive: false">
      <a-tube radius="0.4" color="#4477cc" opacity="0.6" path="curveGeneral"></a-tube>
    </a-entity>

    <!-- Galakse rutsjebane (lilla/blå) -->
    <a-curve id="curveGalaxy">
      <a-curve-point position="0 4 0"></a-curve-point>
      <a-curve-point position="0 3 -8"></a-curve-point>
      <a-curve-point position="2 2 -16"></a-curve-point>
      <a-curve-point position="0 1.6 -30"></a-curve-point>
    </a-curve>
    <a-entity>
      <a-tube radius="0.45" color="#6a57c7" opacity="0.7" path="curveGalaxy"></a-tube>
    </a-entity>

    <!-- Halloween rutsjebane (orange) -->
    <a-curve id="curveHalloween">
      <a-curve-point position="0 4 0"></a-curve-point>
      <a-curve-point position="0 3 -10"></a-curve-point>
      <a-curve-point position="2 2 -20"></a-curve-point>
      <a-curve-point position="0 1.6 -35"></a-curve-point>
    </a-curve>
    <a-entity>
      <a-tube radius="0.5" color="#aa4422" opacity="0.7" path="curveHalloween"></a-tube>
    </a-entity>

    <!-- Galleri ring med 12 billeder -->
    <a-entity gallery-ring="radius: 14; y: 1.6; width: 3.2; height: 2.2"></a-entity>

    <!-- Kamera‑rig med bevægelse og snap-turn -->
    <a-entity id="rig" position="0 0 0" movement-controls snap-turn-keys>
      <a-entity id="camera" camera position="0 1.6 0"
                look-controls="pointerLockEnabled: true"
                cursor="rayOrigin: mouse"
                raycaster="objects: .clickable; far: 40">
      </a-entity>
      <!-- Laserkontroller -->
      <a-entity laser-controls="hand: left"  raycaster="objects: .clickable; far: 40"></a-entity>
      <a-entity laser-controls="hand: right" raycaster="objects: .clickable; far: 40"></a-entity>
      <!-- Blink teleport på Oculus Touch -->
      <a-entity oculus-touch-controls="hand: left"  blink-controls="cameraRig: #rig"></a-entity>
      <a-entity oculus-touch-controls="hand: right" blink-controls="cameraRig: #rig"></a-entity>
    </a-entity>

    <!-- Viewer til at vise store billeder. Klik lukker den. -->
    <a-plane id="viewer" class="clickable" image-viewer
             position="0 1.6 -2.5" width="3.0" height="2.2"
             material="shader: standard; src: #img1; transparent: true; opacity: 0; side: double">
    </a-plane>

    <!-- Instruktions‑tekst -->
    <a-entity position="0 3.2 -2.5"
      text="value: Bevæg dig med WASD/thumbstick • Klik på billederne for at se dem eller starte en rutsjebane!; align: center; width: 4.5; color: #E6E6E6; wrapCount: 50">
    </a-entity>
  </a-scene>
</body>
</html>
